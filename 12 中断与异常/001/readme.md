# *1 概念与处理流程*

## 1. 中断的概念

来自各种硬件外设的中断事件（中断源），经过中断控制器后到达CPU。或者CPU遇到指令错误、数据访问有问题、Reset信号时，产生异常。中断也属于是一种异常。

![](https://ding-aliyun.oss-cn-shenzhen.aliyuncs.com/s3c2440/12_1_1_int.png)

## 2. ARM对异常(中断)的处理过程

1. 初始化

    1. 设置中断源，让他可以产生中断
    2. 设置中断控制器（屏蔽/打开 优先级）
    3. 设置CPU总开关，使能中断

2. 执行程序
3. 产生中断：如 按下按键->中断控制器->CPU
4. CPU每执行完一条指令，都会检查有无中断 / 异常产生
5. 发现有中断 / 异常产生，开始处理

    对于不同的异常，会跳去不同的地址执行程序。这些地址上，只是1条跳转指令，跳去执行其他函数

    这些地址通常是连续的排在一块，称为异常向量。当发生异常 / 中断时，CPU自动跳到对应的地址去执行，我们在该地址处又放了1条跳转指令。

    注意：CPU上电执行的第1条指令，就是reset。此时还没有重定位代码，不可访问SDRAM，所以要使用位置无关码b来跳转，使代码能在NorFlash上执行。上电启动文件`start.S`执行完后，已经完成了代码重定向。因此，产生其他异常时，CPU跳转到0x18地址（位于NorFlash），然后`ldr pc, _irq`绝对跳转，又从NorFlash跳回到SDRAM。

    因此，reset异常是在NorFlash上执行，其他异常在重定位后的SDRAM上执行。

![](https://ding-aliyun.oss-cn-shenzhen.aliyuncs.com/s3c2440/12_1_2_int_vector.png)


6. 这些函数处理流程

    1. 保存现场（各种寄存器）
    2. 处理中断/ 异常：再调用不同的中断处理函数
    3. 恢复现场

